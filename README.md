# plasma-backup

`WORK IN PROGRESS` `EXPERIMENTAL SOFTWARE` `README COMING SOON`

----------------

Так, ну чё, плазма пошла в продакшен.

Получилась очень тупая бэкапилка, но с одной особенностью. Она делает снапшот btrfs и упаковывает все файлы ровно в том виде, в каком они были в момент создания снимка.

На практике это означает, что ты можешь забэкапить работающую БД. Если потом восстановить её из этого бэкапа, СУБД просто подумает, что выключилось питание, и продолжит работать как ни в чём не бывало.

Я уже проверил. И MySQL, и постгрес из такого снимка восстанавливаются за секунду.

Документации, как всегда, нет, зато есть исходники. В целом - собираешь арчевый пакет, ставишь на обе машины.

На той, с которой бэкапишь, редактируешь /etc/plasma-agent.json.

Стратегий две: tar и btrfs-snapshot. Остальное вроде и так понятно.

На той, на которую бэкапишь, нужно создать какую-нибудь папку и положить туда plasma-rotate.json.

```
{
  "policy": {
    "daily": 5,
    "weekly": 3,
    "monthly": 2
  }
}
```

Что-то такое. Сколько каких бэкапов хранить.

Ещё нужно, чтобы агент мог достучаться до хранилища по SSH без ввода пароля.

И... всё. Запускаешь plasma-agent, пробуешь. Если всё ок - sudo systemctl enable plasma-agent.timer. И каждую полночь оно будет того.

Ставится где-то за три минуты (если ты автор).

Важная деталь. Она тупая и ожидает, что btrfs корневая и все папки бэкапятся только с неё.
